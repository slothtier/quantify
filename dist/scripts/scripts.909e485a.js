"use strict";angular.module("quantifyApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngRoute","quantifyApp.controllers"]).run(["$rootScope","$location",function($rootScope,$location){$location.$$hash.search(/([A-Za-z0-9_-]{155})/gi)>-1&&($rootScope.location=$location.$$hash,$location.path("/main"),$location.url($location.path()))}]).config(["$routeProvider","$locationProvider",function($routeProvider,$locationProvider){$routeProvider.when("/main",{templateUrl:"views/main.html",controller:"QuantifyCtrl"}).when("/auth",{templateUrl:"views/auth.html",controller:"AuthCtrl"}).otherwise({redirectTo:"/auth"}),$locationProvider.html5Mode(!0)}]),angular.module("quantifyApp.controllers",[]).controller("QuantifyCtrl",["$scope",function(){}]).controller("AuthCtrl",["$scope",function($scope){$scope.authenticate=function(){var accountUrl="https://accounts.spotify.com/authorize",clientID="client_id=2877dc4791af41e0b53de799f8cf2472",redirectUri="redirect_uri=https%3A%2F%2Fslothtier.github.io%2Fquantify%2Findex.html",authScope="scope=playlist-read-private",responseType="response_type=token",state="state=123";window.location.href=accountUrl+"?"+clientID+"&"+redirectUri+"&"+authScope+"&"+responseType+"&"+state}}]).controller("DataCtrl",function($scope,$http,$rootScope){$scope.invalidUrl="please enter a valid spotify playlist url or uri",$scope.getPlaylistData=function(){var accessToken=$rootScope.location.match(/([A-Za-z0-9_-]{155})/gi)[0];if(void 0===$scope.model||null===$scope.model||-1===$scope.model.url.search(/[\w]{22}/gi))$scope.invalidUrl="please enter a valid spotify playlist url or uri",$scope.model.url="",$scope.showPlaylist=!1;else{$scope.invalidUrl="",$scope.errorMessage="";var userID=$scope.model.url.match(/([A-Za-z0-9_]{8,40})/gi)[0],playlistID=$scope.model.url.substr($scope.model.url.search(/[\w]{22}/gi),22),apiUrl="https://api.spotify.com/v1/users/"+userID+"/playlists/"+playlistID,authString="Bearer "+accessToken;$http({method:"GET",url:apiUrl,headers:{Authorization:authString}}).success(function(data){function msToTime(dur){var seconds=parseInt(dur/1e3%60),minutes=parseInt(dur/6e4%60),hours=parseInt(dur/36e5%24);return hours=10>hours?"0"+hours:hours,minutes=10>minutes?"0"+minutes:minutes,seconds=10>seconds?"0"+seconds:seconds,hours+" hr "+minutes+" min "+seconds+" sec"}var completeResponse=data,trackResponse=completeResponse.tracks;$scope.playlistName=completeResponse.name,$scope.playlistTrackcount=trackResponse.total,$scope.playlistItems=trackResponse.items,$scope.tracks=[],$scope.tracklist=[],angular.forEach(trackResponse.items,function(item){$scope.tracks.push(item)});for(var i=0;i<Object.keys($scope.tracks).length;i++)$scope.tracklist.push($scope.tracks[i].track);for(var durationMs=0,j=0;j<Object.keys($scope.tracks).length;j++)durationMs+=$scope.tracklist[j].duration_ms;$scope.playlistDuration=msToTime(durationMs),$scope.durationMin=durationMs/1e3/60,$scope.sizeNormalQuality=Math.ceil(60*$scope.durationMin*12/1e3),$scope.sizeHighQuality=Math.ceil(60*$scope.durationMin*20/1e3),$scope.sizeExtremeQuality=Math.ceil(60*$scope.durationMin*40/1e3),$scope.sizeNormalQualityReal=Math.ceil(60*$scope.durationMin*11.5/1e3),$scope.sizeHighQualityReal=Math.ceil(60*$scope.durationMin*19.2/1e3),$scope.sizeExtremeQualityReal=Math.ceil(60*$scope.durationMin*35.1/1e3),$scope.showPlaylist=!0}).error(function(data){$scope.errorMessage=401===data.error.status?"your access token has expired, please re-authenticate.":404===data.error.status?"playlist data could not be found.":"uh oh.. something went horribly wrong.",$scope.showPlaylist=!1})}}});